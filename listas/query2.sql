SELECT sales_item_12nc, web_publish_url from (WITH test_material_marking AS ( SELECT DISTINCT c.parent_12nc AS sales_item_12nc, b.WEB_PUBLISH_URL FROM eim.plma_material_collection drv INNER JOIN eim.plm_relationships a ON drv.part_12nc = a.parent_12nc AND drv.revision_value = a.parent_revision INNER JOIN eim.PLMA_MARKING_INSTRUCTION b ON a.child_name = b.marking_instruction_number AND b.effective_to_dttm = '3999-12-31 00:00:00' INNER JOIN eim.plma_bom_explosion_any_level c ON drv.part_12nc = c.part_12nc AND c.parent_type = 'Sales Item' AND c.explosion_direction = 'FORWARD' INNER JOIN eim.material_nxp d ON c.parent_12nc = d.part_12nc AND d.product_status IN ('DEV','DOD','RFS','CQS','ASM') AND d.SALES_ITEM_ORDER_ACCEPTANCE_INDICATOR = 'Y' WHERE a.child_type LIKE ('Marking%Instruction') AND a.parent_type <> 'ICAM' ) SELECT * FROM test_material_marking UNION SELECT DISTINCT c.parent_12nc AS sales_item_12nc, b.WEB_PUBLISH_URL FROM eim.plma_material_collection drv INNER JOIN eim.plm_relationships a ON drv.part_12nc = a.parent_12nc AND drv.revision_value = a.parent_revision INNER JOIN eim.PLMA_MARKING_INSTRUCTION b ON a.child_name = b.marking_instruction_number AND b.effective_to_dttm = '3999-12-31 00:00:00' INNER JOIN eim.plma_bom_explosion_any_level c ON drv.part_12nc = c.part_12nc AND c.parent_type = 'Sales Item' AND c.explosion_direction = 'FORWARD' INNER JOIN eim.material_nxp d ON c.parent_12nc = d.part_12nc AND d.product_status IN ('DEV','DOD','RFS','CQS','ASM') AND d.SALES_ITEM_ORDER_ACCEPTANCE_INDICATOR = 'Y' WHERE a.child_type LIKE ('Marking%Instruction') AND a.parent_type = 'ICAM' AND c.parent_12nc NOT IN (SELECT sales_item_12nc FROM test_material_marking)) material;